{% extends 'base.html' %}
{% load static %}
{% block title %}Academic Tools - GPA Calculator{% endblock %}

{% block extra_head %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.12.0/cdn.min.js" defer></script>
<style>
  /* Additional custom styles */
  .grade-cell {
    cursor: pointer;
    transition: all 0.2s;
  }
  .grade-cell:hover {
    background-color: rgba(59, 130, 246, 0.1);
  }
  .grade-cell.selected {
    background-color: rgba(59, 130, 246, 0.2);
    font-weight: bold;
  }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8" x-data="gpaCalculator()">
  <h1 class="text-3xl font-bold text-center mb-8">GPA/CGPA Calculator</h1>
  
  <div class="bg-white shadow-md rounded-lg p-6 mb-8">
    <h2 class="text-xl font-semibold mb-4">Select Academic Details</h2>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Level</label>
        <select x-model="selectedLevel" @change="loadCourses()" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
          <option value="">Select Level</option>
          {% for level in levels %}
            <option value="{{ level.id }}">{{ level.name }}</option>
          {% endfor %}
        </select>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Semester</label>
        <select x-model="selectedSemester" @change="loadCourses()" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">
          <option value="">Select Semester</option>
          {% for semester in semesters %}
            <option value="{{ semester.id }}">{{ semester.name }}</option>
          {% endfor %}
        </select>
      </div>
    </div>
    
    <div class="mb-6">
      <label class="block text-sm font-medium text-gray-700 mb-1">Search Course</label>
      <div class="relative">
        <input type="text" x-model="searchQuery" placeholder="Search by course code or title" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 pl-10">
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
          <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
          </svg>
        </div>
      </div>
    </div>
    
    <div x-show="filteredCourses.length > 0" class="mb-6">
      <h3 class="text-lg font-medium mb-2">Available Courses</h3>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Code</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Credit Units</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <template x-for="course in filteredCourses" :key="course.id">
              <tr>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" x-text="course.code"></td>
                <td class="px-6 py-4 text-sm text-gray-500" x-text="course.title"></td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="course.credit_units"></td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                  <button 
                    @click="addCourse(course)" 
                    class="text-blue-600 hover:text-blue-900"
                    x-show="!isSelected(course.id)"
                  >Add to calculation</button>
                  <span x-show="isSelected(course.id)" class="text-green-600">Added</span>
                </td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <div class="bg-white shadow-md rounded-lg p-6 mb-8" x-show="selectedCourses.length > 0">
    <h2 class="text-xl font-semibold mb-4">GPA Calculation</h2>
    
    <div class="overflow-x-auto mb-6">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Credit Units</th>
            <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider" colspan="6">Grade</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Credit Points</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
          </tr>
          <tr>
            <th colspan="2"></th>
            <th class="px-2 py-2 text-center text-xs font-medium text-gray-500">A<br>(5.0)</th>
            <th class="px-2 py-2 text-center text-xs font-medium text-gray-500">B<br>(4.0)</th>
            <th class="px-2 py-2 text-center text-xs font-medium text-gray-500">C<br>(3.0)</th>
            <th class="px-2 py-2 text-center text-xs font-medium text-gray-500">D<br>(2.0)</th>
            <th class="px-2 py-2 text-center text-xs font-medium text-gray-500">E<br>(1.0)</th>
            <th class="px-2 py-2 text-center text-xs font-medium text-gray-500">F<br>(0.0)</th>
            <th colspan="2"></th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <template x-for="(course, index) in selectedCourses" :key="course.id">
            <tr>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                <span x-text="course.code"></span> - <span x-text="course.title"></span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" x-text="course.credit_units"></td>
              <td class="px-2 py-4 text-center">
                <div 
                  class="grade-cell w-8 h-8 rounded-full mx-auto flex items-center justify-center"
                  :class="{'selected': course.grade === 'A'}"
                  @click="selectGrade(index, 'A')"
                >A</div>
              </td>
              <td class="px-2 py-4 text-center">
                <div 
                  class="grade-cell w-8 h-8 rounded-full mx-auto flex items-center justify-center"
                  :class="{'selected': course.grade === 'B'}"
                  @click="selectGrade(index, 'B')"
                >B</div>
              </td>
              <td class="px-2 py-4 text-center">
                <div 
                  class="grade-cell w-8 h-8 rounded-full mx-auto flex items-center justify-center"
                  :class="{'selected': course.grade === 'C'}"
                  @click="selectGrade(index, 'C')"
                >C</div>
              </td>
              <td class="px-2 py-4 text-center">
                <div 
                  class="grade-cell w-8 h-8 rounded-full mx-auto flex items-center justify-center"
                  :class="{'selected': course.grade === 'D'}"
                  @click="selectGrade(index, 'D')"
                >D</div>
              </td>
              <td class="px-2 py-4 text-center">
                <div 
                  class="grade-cell w-8 h-8 rounded-full mx-auto flex items-center justify-center"
                  :class="{'selected': course.grade === 'E'}"
                  @click="selectGrade(index, 'E')"
                >E</div>
              </td>
              <td class="px-2 py-4 text-center">
                <div 
                  class="grade-cell w-8 h-8 rounded-full mx-auto flex items-center justify-center"
                  :class="{'selected': course.grade === 'F'}"
                  @click="selectGrade(index, 'F')"
                >F</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium" x-text="calculateCreditPoints(course)"></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                <button @click="removeCourse(index)" class="text-red-600 hover:text-red-900">Remove</button>
              </td>
            </tr>
          </template>
          <tr class="bg-gray-50 font-medium">
            <td class="px-6 py-4 text-sm text-gray-900">Total</td>
            <td class="px-6 py-4 text-sm text-gray-900 text-center" x-text="totalCreditUnits"></td>
            <td colspan="6"></td>
            <td class="px-6 py-4 text-sm text-gray-900" x-text="totalCreditPoints"></td>
            <td></td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div class="bg-blue-50 p-4 rounded-md">
      <div class="flex flex-wrap items-center gap-4">
        <div>
          <span class="text-gray-700 font-medium">GPA:</span>
          <span class="text-2xl font-bold text-blue-700 ml-2" x-text="calculateGPA()"></span>
        </div>
        
        <button 
          @click="saveGPA()" 
          class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition"
        >
          Save This Semester GPA
        </button>
      </div>
    </div>
  </div>
  
  <div class="bg-white shadow-md rounded-lg p-6 mb-8" x-show="savedSemesters.length > 0">
    <h2 class="text-xl font-semibold mb-4">CGPA Calculation</h2>
    
    <div class="overflow-x-auto mb-6">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Level/Semester</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">GPA</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Credit Units</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Credit Points</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <template x-for="(semester, index) in savedSemesters" :key="index">
            <tr>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="semester.label"></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="semester.gpa"></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="semester.total_credit_units"></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="semester.total_credit_points"></td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                <button @click="removeSavedSemester(index)" class="text-red-600 hover:text-red-900">Remove</button>
              </td>
            </tr>
          </template>
          <tr class="bg-gray-50 font-medium">
            <td class="px-6 py-4 text-sm text-gray-900">Total</td>
            <td></td>
            <td class="px-6 py-4 text-sm text-gray-900" x-text="cgpaTotalCreditUnits"></td>
            <td class="px-6 py-4 text-sm text-gray-900" x-text="cgpaTotalCreditPoints"></td>
            <td></td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div class="bg-blue-50 p-4 rounded-md">
      <div class="flex flex-wrap items-center gap-4">
        <div>
          <span class="text-gray-700 font-medium">CGPA:</span>
          <span class="text-2xl font-bold text-blue-700 ml-2" x-text="calculateCGPA()"></span>
        </div>
        
        <button 
          @click="saveCGPA()" 
          class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition"
        >
          Save CGPA Result
        </button>
        
        <button 
          @click="resetCalculator()" 
          class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-md transition ml-auto"
        >
          Reset Calculator
        </button>
      </div>
    </div>
  </div>
  
  <div class="bg-gray-100 p-6 rounded-lg mb-8">
    <h2 class="text-xl font-semibold mb-4">Grading System</h2>
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
      <div class="bg-white p-3 rounded shadow-sm">
        <div class="text-lg font-bold text-center">A</div>
        <div class="text-sm text-gray-600 text-center">70-100%</div>
        <div class="text-lg font-medium text-center text-blue-700">5.00</div>
      </div>
      <div class="bg-white p-3 rounded shadow-sm">
        <div class="text-lg font-bold text-center">B</div>
        <div class="text-sm text-gray-600 text-center">60-69%</div>
        <div class="text-lg font-medium text-center text-blue-700">4.00</div>
      </div>
      <div class="bg-white p-3 rounded shadow-sm">
        <div class="text-lg font-bold text-center">C</div>
        <div class="text-sm text-gray-600 text-center">50-59%</div>
        <div class="text-lg font-medium text-center text-blue-700">3.00</div>
      </div>
      <div class="bg-white p-3 rounded shadow-sm">
        <div class="text-lg font-bold text-center">D</div>
        <div class="text-sm text-gray-600 text-center">45-49%</div>
        <div class="text-lg font-medium text-center text-blue-700">2.00</div>
      </div>
      <div class="bg-white p-3 rounded shadow-sm">
        <div class="text-lg font-bold text-center">E</div>
        <div class="text-sm text-gray-600 text-center">40-44%</div>
        <div class="text-lg font-medium text-center text-blue-700">1.00</div>
      </div>
      <div class="bg-white p-3 rounded shadow-sm">
        <div class="text-lg font-bold text-center">F</div>
        <div class="text-sm text-gray-600 text-center">0-39%</div>
        <div class="text-lg font-medium text-center text-blue-700">0.00</div>
      </div>
    </div>
  </div>
</div>

<script src="{% static 'js/gpa_calculator.js' %}"></script>
{% endblock %}