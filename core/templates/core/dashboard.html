{% extends "base.html" %}

{% block title %}Dashboard - Kumotechs Tools{% endblock %}

{% block content %}
<div class="space-y-6" x-data="dashboardData()">
    <!-- Welcome Header -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
            <div>
                <h1 class="text-xl font-bold text-gray-900 dark:text-white">Welcome to Kumotechs Tools</h1>
                <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">Select a tool to get started or view your recent activity below.</p>
            </div>
            <div class="mt-3 sm:mt-0">
                <div class="flex items-center space-x-4 text-xs text-gray-500 dark:text-gray-400">
                    <span><i class="fas fa-clock mr-1"></i>Last login: {{ user.last_login|date:"M d, H:i" }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Messages -->
    {% if messages %}
        {% for message in messages %}
            <div class="p-3 rounded-md border {% if message.tags == 'error' %}bg-red-50 border-red-200 text-red-700 dark:bg-red-900/20 dark:border-red-800 dark:text-red-200{% elif message.tags == 'success' %}bg-green-50 border-green-200 text-green-700 dark:bg-green-900/20 dark:border-green-800 dark:text-green-200{% else %}bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-900/20 dark:border-blue-800 dark:text-blue-200{% endif %}">
                <div class="flex items-center justify-between">
                    <span class="text-sm">{{ message }}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-current opacity-70 hover:opacity-100">
                        <i class="fas fa-times text-xs"></i>
                    </button>
                </div>
            </div>
        {% endfor %}
    {% endif %}

    <!-- Quick Stats -->
    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
        <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 p-3 rounded-lg border border-blue-200 dark:border-blue-800">
            <div class="flex items-center">
                <i class="fas fa-link text-blue-600 dark:text-blue-400 mr-2"></i>
                <div>
                    <div class="text-lg font-bold text-blue-900 dark:text-blue-100">{{ user_links|length|default:0 }}</div>
                    <div class="text-xs text-blue-700 dark:text-blue-300">Short URLs</div>
                </div>
            </div>
        </div>
        <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 p-3 rounded-lg border border-green-200 dark:border-green-800">
            <div class="flex items-center">
                <i class="fas fa-users text-green-600 dark:text-green-400 mr-2"></i>
                <div>
                    <div class="text-lg font-bold text-green-900 dark:text-green-100">{{ user_contacts|length|default:0 }}</div>
                    <div class="text-xs text-green-700 dark:text-green-300">Contacts</div>
                </div>
            </div>
        </div>
        <div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 p-3 rounded-lg border border-purple-200 dark:border-purple-800">
            <div class="flex items-center">
                <i class="fas fa-globe text-purple-600 dark:text-purple-400 mr-2"></i>
                <div>
                    <div class="text-lg font-bold text-purple-900 dark:text-purple-100">{{ user_analyses|length|default:0 }}</div>
                    <div class="text-xs text-purple-700 dark:text-purple-300">Analyses</div>
                </div>
            </div>
        </div>
        <div class="bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 p-3 rounded-lg border border-orange-200 dark:border-orange-800">
            <div class="flex items-center">
                <i class="fas fa-images text-orange-600 dark:text-orange-400 mr-2"></i>
                <div>
                    <div class="text-lg font-bold text-orange-900 dark:text-orange-100">{{ user_media|length|default:0 }}</div>
                    <div class="text-xs text-orange-700 dark:text-orange-300">Media Files</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tool Cards -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Available Tools</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            
            <!-- Contact Manager -->
            <div class="group bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800 hover:shadow-md transition-all duration-200 hover:-translate-y-1">
                <div class="flex items-start justify-between mb-3">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                            <i class="fas fa-address-book text-white text-sm"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-semibold text-gray-900 dark:text-white">Contact Manager</h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400">Manage contacts & export VCF</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-xs text-blue-700 dark:text-blue-300">Contact VCF Export</span>
                    <a href="{% url 'manage_contacts' %}" class="inline-flex items-center px-3 py-1 text-xs font-medium text-blue-700 dark:text-blue-300 hover:text-blue-900 dark:hover:text-blue-100 transition-colors">
                        Open <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>

            <!-- URL Shortener -->
            <div class="group bg-gradient-to-br from-indigo-50 to-indigo-100 dark:from-indigo-900/20 dark:to-indigo-800/20 rounded-lg p-4 border border-indigo-200 dark:border-indigo-800 hover:shadow-md transition-all duration-200 hover:-translate-y-1">
                <div class="flex items-start justify-between mb-3">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                            <i class="fas fa-link text-white text-sm"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-semibold text-gray-900 dark:text-white">URL Shortener</h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400">Create & manage short URLs</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-xs text-indigo-700 dark:text-indigo-300">Shortlinks Generator</span>
                    <a href="{% url 'shortlinks:shortener' %}" class="inline-flex items-center px-3 py-1 text-xs font-medium text-indigo-700 dark:text-indigo-300 hover:text-indigo-900 dark:hover:text-indigo-100 transition-colors">
                        Open <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>

            <!-- CDN Tool -->
            <div class="group bg-gradient-to-br from-cyan-50 to-cyan-100 dark:from-cyan-900/20 dark:to-cyan-800/20 rounded-lg p-4 border border-cyan-200 dark:border-cyan-800 hover:shadow-md transition-all duration-200 hover:-translate-y-1">
                <div class="flex items-start justify-between mb-3">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-cyan-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                            <i class="fas fa-cloud text-white text-sm"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-semibold text-gray-900 dark:text-white">CDN Tool</h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400">Upload & manage CDN files</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-xs text-cyan-700 dark:text-cyan-300">File hosting & CDN</span>
                    <a href="{% url 'cdn_tool:dashboard' %}" class="inline-flex items-center px-3 py-1 text-xs font-medium text-cyan-700 dark:text-cyan-300 hover:text-cyan-900 dark:hover:text-cyan-100 transition-colors">
                        Open <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>

            <!-- Media Processing -->
            <div class="group bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-lg p-4 border border-green-200 dark:border-green-800 hover:shadow-md transition-all duration-200 hover:-translate-y-1">
                <div class="flex items-start justify-between mb-3">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                            <i class="fas fa-images text-white text-sm"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-semibold text-gray-900 dark:text-white">Media Processing</h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400">Convert, compress & extract</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-xs text-green-700 dark:text-green-300">Image convert/compress</span>
                    <a href="{% url 'media_toolkit:dashboard' %}" class="inline-flex items-center px-3 py-1 text-xs font-medium text-green-700 dark:text-green-300 hover:text-green-900 dark:hover:text-green-100 transition-colors">
                        Open <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>

            <!-- Website Analyzer -->
            <div class="group bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-lg p-4 border border-purple-200 dark:border-purple-800 hover:shadow-md transition-all duration-200 hover:-translate-y-1">
                <div class="flex items-start justify-between mb-3">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-purple-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                            <i class="fas fa-globe text-white text-sm"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-semibold text-gray-900 dark:text-white">Website Analyzer</h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400">Analyze tech stacks & SEO</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-xs text-purple-700 dark:text-purple-300">Website info saver</span>
                    <a href="{% url 'webanalyzer:dashboard' %}" class="inline-flex items-center px-3 py-1 text-xs font-medium text-purple-700 dark:text-purple-300 hover:text-purple-900 dark:hover:text-purple-100 transition-colors">
                        Open <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>

            <!-- Web Performance Tester -->
            <div class="group bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-lg p-4 border border-orange-200 dark:border-orange-800 hover:shadow-md transition-all duration-200 hover:-translate-y-1">
                <div class="flex items-start justify-between mb-3">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-orange-600 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                            <i class="fas fa-tachometer-alt text-white text-sm"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-semibold text-gray-900 dark:text-white">Performance Tester</h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400">Load testing & monitoring</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-xs text-orange-700 dark:text-orange-300">Speed & load tests</span>
                    <a href="{% url 'webtester:dashboard' %}" class="inline-flex items-center px-3 py-1 text-xs font-medium text-orange-700 dark:text-orange-300 hover:text-orange-900 dark:hover:text-orange-100 transition-colors">
                        Open <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
        <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center justify-between">
                <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Recent Activity</h2>
                <button @click="toggleAllSections()" class="text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <span x-text="allExpanded ? 'Collapse All' : 'Expand All'"></span>
                </button>
            </div>
        </div>

        <div class="divide-y divide-gray-200 dark:divide-gray-700">
            <!-- Recent URLs -->
            {% if recent_links %}
            <div class="px-4 py-4" x-data="{ expanded: true }">
                <div class="flex items-center justify-between cursor-pointer" @click="expanded = !expanded">
                    <h3 class="text-sm font-medium text-gray-900 dark:text-white flex items-center">
                        <i class="fas fa-link text-indigo-500 mr-2 text-xs"></i>
                        Recent URLs ({{ recent_links|length }})
                    </h3>
                    <i class="fas fa-chevron-down text-xs text-gray-400 transition-transform" :class="expanded ? 'rotate-180' : ''"></i>
                </div>
                <div x-show="expanded" x-transition class="mt-3 space-y-2">
                    {% for link in recent_links %}
                    <div class="flex items-center justify-between py-2 px-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                        <div class="flex items-center min-w-0 flex-1">
                            <div class="w-2 h-2 bg-indigo-500 rounded-full mr-3 flex-shrink-0"></div>
                            <span class="text-sm text-gray-700 dark:text-gray-300 truncate">{{ link.original_url|truncatechars:50 }}</span>
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 ml-2">{{ link.created_at|date:"M d" }}</div>
                    </div>
                    {% endfor %}
                    <div class="pt-2">
                        <a href="{% url 'shortlinks:shortener' %}" class="text-xs text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300 font-medium">
                            View all URLs →
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Recent Website Analyses -->
            {% if recent_analyses %}
            <div class="px-4 py-4" x-data="{ expanded: false }">
                <div class="flex items-center justify-between cursor-pointer" @click="expanded = !expanded">
                    <h3 class="text-sm font-medium text-gray-900 dark:text-white flex items-center">
                        <i class="fas fa-globe text-purple-500 mr-2 text-xs"></i>
                        Recent Analyses ({{ recent_analyses|length }})
                    </h3>
                    <i class="fas fa-chevron-down text-xs text-gray-400 transition-transform" :class="expanded ? 'rotate-180' : ''"></i>
                </div>
                <div x-show="expanded" x-transition class="mt-3 space-y-2">
                    {% for analysis in recent_analyses %}
                    <div class="flex items-center justify-between py-2 px-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                        <div class="flex items-center min-w-0 flex-1">
                            <div class="w-2 h-2 bg-purple-500 rounded-full mr-3 flex-shrink-0"></div>
                            <span class="text-sm text-gray-700 dark:text-gray-300 truncate">
                                {% if analysis.title %}{{ analysis.title|truncatechars:50 }}{% else %}{{ analysis.url|truncatechars:50 }}{% endif %}
                            </span>
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 ml-2">{{ analysis.created_at|date:"M d" }}</div>
                    </div>
                    {% endfor %}
                    <div class="pt-2">
                        <a href="{% url 'webanalyzer:dashboard' %}" class="text-xs text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-300 font-medium">
                            View all analyses →
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Recent Contacts -->
            {% if recent_contacts %}
            <div class="px-4 py-4" x-data="{ expanded: false }">
                <div class="flex items-center justify-between cursor-pointer" @click="expanded = !expanded">
                    <h3 class="text-sm font-medium text-gray-900 dark:text-white flex items-center">
                        <i class="fas fa-user text-blue-500 mr-2 text-xs"></i>
                        Recent Contacts ({{ recent_contacts|length }})
                    </h3>
                    <i class="fas fa-chevron-down text-xs text-gray-400 transition-transform" :class="expanded ? 'rotate-180' : ''"></i>
                </div>
                <div x-show="expanded" x-transition class="mt-3 space-y-2">
                    {% for contact in recent_contacts %}
                    <div class="flex items-center justify-between py-2 px-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                        <div class="flex items-center min-w-0 flex-1">
                            <div class="w-2 h-2 bg-blue-500 rounded-full mr-3 flex-shrink-0"></div>
                            <span class="text-sm text-gray-700 dark:text-gray-300">{{ contact.name }}</span>
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 ml-2">{{ contact.created_at|date:"M d" }}</div>
                    </div>
                    {% endfor %}
                    <div class="pt-2">
                        <a href="{% url 'manage_contacts' %}" class="text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 font-medium">
                            View all contacts →
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Recent Media -->
            {% if recent_media %}
            <div class="px-4 py-4" x-data="{ expanded: false }">
                <div class="flex items-center justify-between cursor-pointer" @click="expanded = !expanded">
                    <h3 class="text-sm font-medium text-gray-900 dark:text-white flex items-center">
                        <i class="fas fa-file text-green-500 mr-2 text-xs"></i>
                        Recent Media ({{ recent_media|length }})
                    </h3>
                    <i class="fas fa-chevron-down text-xs text-gray-400 transition-transform" :class="expanded ? 'rotate-180' : ''"></i>
                </div>
                <div x-show="expanded" x-transition class="mt-3 space-y-2">
                    {% for media in recent_media %}
                    <div class="flex items-center justify-between py-2 px-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                        <div class="flex items-center min-w-0 flex-1">
                            <div class="w-2 h-2 bg-green-500 rounded-full mr-3 flex-shrink-0"></div>
                            <span class="text-sm text-gray-700 dark:text-gray-300 truncate">{{ media.original_file.name|truncatechars:40 }}</span>
                            <span class="ml-2 text-xs px-2 py-1 rounded bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300">
                                {{ media.get_processing_type_display }}
                            </span>
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 ml-2">{{ media.created_at|date:"M d" }}</div>
                    </div>
                    {% endfor %}
                    <div class="pt-2">
                        <a href="{% url 'media_toolkit:file_list' %}" class="text-xs text-green-600 hover:text-green-800 dark:text-green-400 dark:hover:text-green-300 font-medium">
                            View all media →
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- No Activity Message -->
            {% if not recent_links and not recent_contacts and not recent_media and not recent_analyses %}
            <div class="px-4 py-8 text-center">
                <div class="w-12 h-12 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-clock text-gray-400 text-lg"></i>
                </div>
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">No recent activity found</p>
                <p class="text-xs text-gray-400 dark:text-gray-500">Start using the tools to see your activity here</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function dashboardData() {
        return {
            allExpanded: false,
            
            toggleAllSections() {
                this.allExpanded = !this.allExpanded;
                
                // Find all section containers and update their expanded state
                const sections = document.querySelectorAll('[x-data*="expanded"]');
                sections.forEach(section => {
                    // Access the Alpine component data
                    const alpineData = Alpine.$data(section);
                    if (alpineData && typeof alpineData.expanded !== 'undefined') {
                        alpineData.expanded = this.allExpanded;
                    }
                });
            }
        }
    }
</script>
{% endblock %}
